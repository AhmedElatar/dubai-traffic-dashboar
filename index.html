<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Traffic Incident Analysis - Dubai</title>
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>
<body style="font-family: Arial; margin: 30px; background-color: #fafafa;">
  <h1 style="text-align:center;">üöó Traffic Incident Analysis - Dubai</h1>

  <!-- Visualization 1 -->
  <h2>1Ô∏è‚É£ Accident Distribution by Day of the Week</h2>
  <div id="vis1"></div>

  <!-- Visualization 2 -->
  <h2>2Ô∏è‚É£ Accident Distribution by Hour of the Day</h2>
  <div id="vis2"></div>

  <!-- Visualization 3 -->
  <h2>3Ô∏è‚É£ Accident Density Map Across Dubai</h2>
  <div id="vis3"></div>

  <script type="text/javascript">
    const dataUrl = "https://raw.githubusercontent.com/sheriefAbdallah/CS318/refs/heads/main/Traffic_Incidents.csv";

    // === Visualization 1 ===
    const vis1 = {
      $schema: "https://vega.github.io/schema/vega-lite/v5.json",
      data: { url: dataUrl },
      transform: [
        { timeUnit: "day", field: "acci_time", as: "day_of_week" },
        { aggregate: [{ op: "count", as: "count" }], groupby: ["day_of_week"] }
      ],
      mark: { type: "bar", color: "#2E86C1" },
      encoding: {
        x: {
          field: "day_of_week",
          type: "ordinal",
          title: "Day of the Week",
          sort: ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"]
        },
        y: { field: "count", type: "quantitative", title: "Number of Accidents" },
        tooltip: [
          { field: "day_of_week", title: "Day" },
          { field: "count", title: "Accidents" }
        ]
      },
      config: { axis: { labelFontSize: 12, titleFontSize: 14 } }
    };

    // === Visualization 2 ===
    const vis2 = {
      $schema: "https://vega.github.io/schema/vega-lite/v5.json",
      data: { url: dataUrl },
      transform: [
        { timeUnit: "hours", field: "acci_time", as: "hour" },
        { timeUnit: "day", field: "acci_time", as: "day_of_week" },
        { aggregate: [{ op: "count", as: "count" }], groupby: ["hour", "day_of_week"] }
      ],
      mark: { type: "line", point: true },
      encoding: {
        x: { field: "hour", type: "ordinal", title: "Hour of the Day" },
        y: { field: "count", type: "quantitative", title: "Number of Accidents" },
        color: { field: "day_of_week", type: "nominal", title: "Day" },
        tooltip: [
          { field: "day_of_week", title: "Day" },
          { field: "hour", title: "Hour" },
          { field: "count", title: "Accidents" }
        ]
      },
      config: { axis: { labelFontSize: 12, titleFontSize: 14 } }
    };

    // === Visualization 3 ===
    const vis3 = {
      $schema: "https://vega.github.io/schema/vega-lite/v5.json",
      width: 800,
      height: 500,
      layer: [
        // ÿÆÿ±Ÿäÿ∑ÿ© ÿßŸÑÿ•ŸÖÿßÿ±ÿßÿ™ ŸÅŸÇÿ∑
        {
          data: {
            url: "https://raw.githubusercontent.com/vega/vega-datasets/main/data/world-110m.json",
            format: { type: "topojson", feature: "countries" }
          },
          transform: [{ filter: "datum.id == 784" }],
          mark: { type: "geoshape", fill: "#e6f2ff", stroke: "#999" }
        },
        // ŸÜŸÇÿßÿ∑ ÿßŸÑÿ≠ŸàÿßÿØÿ´
        {
          data: { url: dataUrl },
          transform: [{ filter: "datum.acci_y > 23" }],
          mark: { type: "circle", opacity: 0.35, color: "red" },
          encoding: {
            longitude: { field: "acci_y", type: "quantitative" },
            latitude: { field: "acci_x", type: "quantitative" },
            size: { value: 25 },
            tooltip: [
              { field: "acci_id", title: "Accident ID" },
              { field: "acci_name", title: "Description" },
              { field: "acci_time", title: "Date & Time" }
            ]
          }
        }
      ],
      projection: { type: "mercator", center: [55.3, 25.25], scale: 10000 },
      title: "Accident Density Map - Dubai (Real Data Points)"
    };

    vegaEmbed("#vis1", vis1);
    vegaEmbed("#vis2", vis2);
    vegaEmbed("#vis3", vis3);
  </script>
</body>
</html>